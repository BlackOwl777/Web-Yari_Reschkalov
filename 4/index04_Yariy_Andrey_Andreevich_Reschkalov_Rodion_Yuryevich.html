<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>index04 - v-if</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
  <div id="app">
    <table border="1" cellpadding="10" style="width: 100%; table-layout: fixed; height: 300px;">
      <tr>
        <td :style="getCellStyle(0, 0)"><span v-if="isActive(0, 0)">{{ text }}</span></td>
        <td :style="getCellStyle(0, 1)"><span v-if="isActive(0, 1)">{{ text }}</span></td>
        <td :style="getCellStyle(0, 2)"><span v-if="isActive(0, 2)">{{ text }}</span></td>
      </tr>
      <tr>
        <td :style="getCellStyle(1, 0)"><span v-if="isActive(1, 0)">{{ text }}</span></td>
        <td :style="getCellStyle(1, 1)"><span v-if="isActive(1, 1)">{{ text }}</span></td>
        <td :style="getCellStyle(1, 2)"><span v-if="isActive(1, 2)">{{ text }}</span></td>
      </tr>
    </table>
    <input 
      type="text" 
      v-model="text" 
      placeholder="Введите текст"
      style="margin-top: 10px; width: 100%;"
    >
  </div>

  <script>
    const { createApp, ref, onMounted, onUnmounted } = Vue;

    createApp({
      setup() {
        const text = ref('');
        const currentCell = ref({ row: 0, col: 1 }); // ✅ Начальная ячейка — центр верхней строки
        const hAlign = ref('center'); // 'left' → 'center' → 'right'
        const vAlign = ref('middle'); // 'top' → 'middle' → 'bottom'

        // Определяет, в какой ячейке отображать текст
        const isActive = (row, col) => {
          return currentCell.value.row === row && currentCell.value.col === col;
        };

        const getCellStyle = (row, col) => {
          if (!isActive(row, col)) return {};
          return {
            textAlign: hAlign.value,
            verticalAlign: vAlign.value,
            backgroundColor: '#f0f8ff'
          };
        };

        const handleKeyDown = (event) => {
          switch (event.key) {
            case 'ArrowLeft':
              event.preventDefault();
              if (hAlign.value === 'left') {
                // Попытка выйти влево — переход в предыдущую ячейку
                if (currentCell.value.col > 0) {
                  currentCell.value.col--;
                  hAlign.value = 'right'; // После перехода — выравнивание по правому краю
                }
              } else if (hAlign.value === 'center') {
                hAlign.value = 'left';
              } else if (hAlign.value === 'right') {
                hAlign.value = 'center';
              }
              break;

            case 'ArrowRight':
              event.preventDefault();
              if (hAlign.value === 'right') {
                // Завершён цикл — переход вправо
                if (currentCell.value.col < 2) {
                  currentCell.value.col++;
                  hAlign.value = 'left';
                }
              } else if (hAlign.value === 'center') {
                hAlign.value = 'right';
              } else if (hAlign.value === 'left') {
                hAlign.value = 'center';
              }
              break;

            case 'ArrowUp':
              event.preventDefault();
              if (vAlign.value === 'top') {
                // Попытка выйти вверх — переход в предыдущую строку
                if (currentCell.value.row > 0) {
                  currentCell.value.row--;
                  vAlign.value = 'bottom';
                }
              } else if (vAlign.value === 'middle') {
                vAlign.value = 'top';
              } else if (vAlign.value === 'bottom') {
                vAlign.value = 'middle';
              }
              break;

            case 'ArrowDown':
              event.preventDefault();
              if (vAlign.value === 'bottom') {
                // Завершён цикл — переход вниз
                if (currentCell.value.row < 1) {
                  currentCell.value.row++;
                  vAlign.value = 'top';
                }
              } else if (vAlign.value === 'middle') {
                vAlign.value = 'bottom';
              } else if (vAlign.value === 'top') {
                vAlign.value = 'middle';
              }
              break;
          }
        };

        onMounted(() => {
          window.addEventListener('keydown', handleKeyDown);
        });

        onUnmounted(() => {
          window.removeEventListener('keydown', handleKeyDown);
        });

        return {
          text,
          currentCell,
          hAlign,
          vAlign,
          isActive,
          getCellStyle
        };
      }
    }).mount('#app');
  </script>
</body>
</html>