<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>index02 - v-on</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
  <div id="app" tabindex="0">
    <input 
      type="text" 
      @keydown="onKeydown"
      @mousedown="onMouseDown"
      placeholder="Нажмите Ctrl+S"
    >
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      setup() {
        // Устанавливаем фокус на приложение
        const appElement = document.getElementById('app');
        if (appElement) {
          appElement.focus();
        }

        const onKeydown = (event) => {
          if (event.ctrlKey && (event.key === 's' || event.key === 'S')) {
            event.preventDefault();
            alert('Сохранение возможно по нажатии сочетания клавиш «Ctrl» + «ЛКМ»');
          }
        };

        const saveFileWithPicker = async (blob, filename) => {
          try {
            const handle = await window.showSaveFilePicker({
              suggestedName: filename,
              types: [{
                description: 'HTML файл',
                accept: { 'text/html': ['.html'] }
              }]
            });
            const writable = await handle.createWritable();
            await writable.write(blob);
            await writable.close();
          } catch (err) {
            if (err.name !== 'AbortError') {
              console.error('Ошибка при сохранении через File Picker:', err);
            }
          }
        };

        const saveFileFallback = (blob, filename) => {
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = filename;
          link.style.display = 'none';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(link.href);
        };

        const onMouseDown = async (event) => {
          if (event.ctrlKey && event.button === 0) {
            event.preventDefault();

            const html = document.documentElement.outerHTML;
            const blob = new Blob([html], { type: 'text/html; charset=utf-8' });
            const filename = 'index02_Yariy_Andrey_Andreevich_Reschkalov_Rodion_Yuryevich.html';

            if ('showSaveFilePicker' in window) {
              // Проверяем, доступен ли File System Access API (работает только в secure context)
              try {
                // Попытка использовать showSaveFilePicker
                await saveFileWithPicker(blob, filename);
              } catch (err) {
                // Если API недоступен (например, из-за file://), переключаемся на fallback
                saveFileFallback(blob, filename);
              }
            } else {
              // Браузер не поддерживает File System Access API
              saveFileFallback(blob, filename);
            }
          }
        };

        return {
          onKeydown,
          onMouseDown
        };
      }
    }).mount('#app');
  </script>
</body>
</html>